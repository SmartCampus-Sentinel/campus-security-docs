以下是完整、可落地的接口文档，所有接口均匹配你之前的前端技术栈（Vue3+Axios、Uni-app），并标注前端开发时的核心注意点。

---

# 校园智能安防平台-前后端接口文档
## 文档说明
| 项          | 内容                                                                 |
|-------------|----------------------------------------------------------------------|
| 文档版本    | v1.0                                                                 |
| 基础API URL | 开发环境：`http://localhost:8080/api`；生产环境：`https://api.xxx.com/api` |
| WebSocket URL | 实时推送：`ws://localhost:8080/ws`（开发环境）|
| 数据格式    | 请求/返回均为`JSON`，编码`UTF-8`                                     |
| 前端适配    | Web端（Vue3+Axios）、小程序端（Uni-app uni.request/uni.uploadFile）|

## 1. 通用配置
### 1.1 通用请求头
所有接口（除登录外）需携带认证头，前端需封装到请求拦截器中：
```javascript
// Web端Axios拦截器示例（标注：需在src/web/utils/request.ts中配置）
headers: {
  'Content-Type': 'application/json',
  'Authorization': 'Bearer ' + localStorage.getItem('token') // Web端存储在localStorage
  // 小程序端：uni.getStorageSync('token')
}
```

### 1.2 通用返回格式
所有接口返回统一结构，前端需统一解析：
```json
{
  "code": 200, // 状态码（标注：200=成功，401=未登录，500=服务端错误）
  "msg": "操作成功", // 提示信息（前端可直接用于Toast/Message提示）
  "data": {}, // 业务数据（接口核心返回值，不同接口结构不同）
  "timestamp": 1710000000000 // 服务器时间戳（前端可用于时间校准）
}
```

### 1.3 核心状态码说明
| 状态码 | 含义                 | 前端处理方式（标注）|
|--------|----------------------|---------------------------------------------|
| 200    | 成功                 | 解析data字段，执行业务逻辑                   |
| 401    | 未登录/Token过期     | 跳转登录页，清空本地token（Web/小程序通用） |
| 403    | 权限不足             | 提示“无操作权限”，返回上一页                 |
| 404    | 接口不存在/资源未找到 | 提示“请求资源不存在”                         |
| 500    | 服务端错误           | 提示“服务器内部错误，请稍后重试”             |

## 2. 系统认证模块（Web/小程序通用）
### 2.1 登录接口
#### 接口信息
| 项         | 内容                                          |
|------------|-----------------------------------------------|
| 接口路径   | `/auth/login`                                 |
| 请求方式   | POST                                          |
| 适用端侧   | Web端（管理员）、小程序端（学生）|
| 无需认证   | 是（标注：唯一不需要Token的接口）|

#### 请求参数
| 参数名    | 类型   | 是否必传 | 说明                     | 前端注意（标注）|
|-----------|--------|----------|--------------------------|--------------------------------------|
| username  | string | 是       | 用户名（管理员/学生学号） | Web端需做非空校验，小程序端绑定手机号可免填 |
| password  | string | 是       | 密码（管理员）/验证码（学生） | 小程序端密码字段实际传验证码，需前端兼容 |
| type      | int    | 是       | 登录类型：1=管理员，2=学生 | 前端需区分端侧传值（Web固定传1，小程序固定传2） |

#### 请求示例
```json
// Web端管理员登录
{
  "username": "admin",
  "password": "123456",
  "type": 1
}
// 小程序学生登录
{
  "username": "20230001",
  "password": "888888", // 短信验证码
  "type": 2
}
```

#### 返回数据
```json
{
  "code": 200,
  "msg": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...", // 前端需存储
    "userInfo": {
      "id": 1,
      "name": "管理员",
      "role": "admin" // Web端：admin/security；小程序端：student
    }
  }
}
```

#### 前端调用注意（标注）
1. Web端登录成功后，`token`存入`localStorage`，`userInfo`存入Pinia；
2. 小程序端`token`存入`uni.setStorageSync('token')`，避免本地存储泄露；
3. 登录失败时（code≠200），前端需提示`msg`字段（如“用户名或密码错误”）。

### 2.2 退出登录接口
| 项         | 内容                  |
|------------|-----------------------|
| 接口路径   | `/auth/logout`        |
| 请求方式   | POST                  |
| 适用端侧   | Web/小程序            |
| 请求参数   | 无（仅需Token）|

#### 返回数据
```json
{
  "code": 200,
  "msg": "退出成功",
  "data": null
}
```

#### 前端调用注意（标注）
- 退出后需清空本地`token`+`userInfo`，并跳转登录页；
- 小程序端需调用`uni.removeStorageSync('token')`。

## 3. Web端-设备管理模块
### 3.1 获取设备列表
#### 接口信息
| 项         | 内容                                          |
|------------|-----------------------------------------------|
| 接口路径   | `/device/list`                                |
| 请求方式   | GET                                           |
| 适用端侧   | Web端（管理员控制台）|
| 分页参数   | 拼接在URL后：`?page=1&size=10&status=1`       |

#### 请求参数（URL参数）
| 参数名 | 类型   | 是否必传 | 说明                     |
|--------|--------|----------|--------------------------|
| page   | int    | 否（默认1） | 页码                     |
| size   | int    | 否（默认10） | 每页条数                 |
| status | int    | 否       | 设备状态：0=离线，1=在线 |

#### 返回数据
```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "total": 100, // 总条数（前端分页组件需用）
    "list": [
      {
        "id": 1,
        "deviceNo": "CAM-001", // 设备编号
        "name": "教学楼A栋摄像头", // 设备名称
        "type": "camera", // 设备类型：camera=摄像头，sensor=传感器
        "status": 1, // 状态（标注：前端需映射为“在线/离线”文本+不同颜色）
        "location": "教学楼A栋3楼",
        "lastOnlineTime": "2026-01-13 10:00:00" // 最后在线时间
      }
    ]
  }
}
```

#### 前端调用注意（标注）
1. Web端需封装分页钩子（如`usePagination`），自动拼接page/size参数；
2. 设备状态需做枚举映射：`const statusMap = { 0: '离线(红色)', 1: '在线(绿色)' }`；
3. 接口需加loading状态（Element Plus的ElLoading）。

### 3.2 设备远程控制（重启/关闭）
| 项         | 内容                  |
|------------|-----------------------|
| 接口路径   | `/device/control`     |
| 请求方式   | POST                  |
| 适用端侧   | Web端                 |

#### 请求参数（JSON）
| 参数名 | 类型   | 是否必传 | 说明                     |
|--------|--------|----------|--------------------------|
| id     | int    | 是       | 设备ID                   |
| action | string | 是       | 操作：restart=重启，stop=关闭 |

#### 前端调用注意（标注）
1. 操作前需加确认弹窗（ElMessageBox.confirm）；
2. 操作后需刷新设备列表，或实时更新单条设备状态；
3. 需处理接口异步耗时（加loading，避免重复点击）。

## 4. Web端-报警管理模块
### 4.1 获取报警列表
| 项         | 内容                                          |
|------------|-----------------------------------------------|
| 接口路径   | `/alarm/list`                                 |
| 请求方式   | GET                                           |
| 适用端侧   | Web端                                         |
| 分页参数   | `?page=1&size=10&status=0&type=break-in`       |

#### 返回数据核心字段
```json
{
  "data": {
    "list": [
      {
        "id": 1,
        "alarmType": "break-in", // 报警类型：break-in=闯入，fire=火情，other=其他
        "deviceNo": "CAM-001",
        "location": "教学楼A栋3楼",
        "status": 0, // 处理状态：0=未处理，1=已处理
        "createTime": "2026-01-13 10:30:00",
        "screenshotUrl": "http://localhost:8080/upload/1.jpg" // 报警截图（前端直接渲染）
      }
    ]
  }
}
```

#### 前端调用注意（标注）
1. 报警截图需用`<img>`渲染，Web端需做懒加载（v-lazy）；
2. 报警类型需映射为中文+图标（如“闯入→🔴”）；
3. 需监听WebSocket实时推送的新报警（见5.1节）。

### 4.2 更新报警处理状态
| 项         | 内容                  |
|------------|-----------------------|
| 接口路径   | `/alarm/updateStatus` |
| 请求方式   | POST                  |
| 适用端侧   | Web端                 |

#### 请求参数
| 参数名 | 类型   | 是否必传 | 说明                     |
|--------|--------|----------|--------------------------|
| id     | int    | 是       | 报警ID                   |
| status | int    | 是       | 处理状态：1=已处理       |
| remark | string | 否       | 处理备注（管理员填写）|

## 5. 实时推送（WebSocket）
### 5.1 报警实时推送
#### 前端对接示例（标注：Web端核心代码，需在src/web/utils/ws.ts中封装）
```typescript
// Web端WebSocket连接（报警实时推送）
export const connectAlarmWS = () => {
  const token = localStorage.getItem('token');
  const ws = new WebSocket(`ws://localhost:8080/ws/alarm?token=${token}`);
  
  ws.onopen = () => console.log('WS连接成功');
  ws.onmessage = (e) => {
    const data = JSON.parse(e.data);
    // 收到新报警：前端推送通知（ElNotification）+ 更新列表
    ElNotification({
      title: '新报警',
      message: `${data.location}发生${data.alarmType}报警`,
      type: 'error',
      duration: 0 // 不自动关闭
    });
  };
  // 断线重连（标注：必须加，避免实时推送中断）
  ws.onclose = () => setTimeout(connectAlarmWS, 5000);
  return ws;
};
```

#### 前端调用注意（标注）
1. WebSocket需携带token鉴权，否则会被服务端断开；
2. 小程序端不支持WebSocket直接传token，需通过header或路径拼接；
3. 页面销毁时需关闭WS连接（避免内存泄漏）。

## 6. 小程序端-隐患上报模块
### 6.1 图片上传（核心）
#### 接口信息
| 项         | 内容                                          |
|------------|-----------------------------------------------|
| 接口路径   | `/upload/image`                               |
| 请求方式   | POST（FormData）|
| 适用端侧   | 小程序端（标注：必须用uni.uploadFile，不能用uni.request） |

#### 前端调用代码（标注：小程序端核心代码，src/miniprogram/api/report.js）
```javascript
export const uploadImage = (tempFilePath) => {
  return new Promise((resolve, reject) => {
    uni.uploadFile({
      url: 'http://localhost:8080/api/upload/image',
      filePath: tempFilePath, // 小程序选择图片后的临时路径
      name: 'file', // 服务端接收的字段名（必须一致）
      header: {
        'Authorization': 'Bearer ' + uni.getStorageSync('token')
      },
      success: (res) => {
        const data = JSON.parse(res.data);
        resolve(data.data.url); // 返回图片的线上URL
      },
      fail: reject
    });
  });
};
```

#### 前端调用注意（标注）
1. 小程序需先调用`uni.chooseImage`获取临时路径，再上传；
2. 上传时需加loading（uni.showLoading），避免用户重复操作；
3. 需处理上传失败（如网络错误），提示用户重新上传。

### 6.2 提交隐患上报
#### 接口信息
| 项         | 内容                                          |
|------------|-----------------------------------------------|
| 接口路径   | `/report/add`                                 |
| 请求方式   | POST                                          |
| 适用端侧   | 小程序端                                     |

#### 请求参数（JSON）
| 参数名     | 类型    | 是否必传 | 说明                     |
|------------|---------|----------|--------------------------|
| content    | string  | 是       | 隐患描述（至少10个字）|
| location   | string  | 是       | 隐患位置（如“食堂2楼”）|
| imageUrls  | array   | 否       | 图片URL列表（上传后返回） |
| contact    | string  | 否       | 联系电话（学生可选填）|

#### 前端调用注意（标注）
1. 提交前需做表单校验：content长度≥10，location非空；
2. 图片上传需先于表单提交（异步串行）；
3. 提交成功后需清空表单，提示“上报成功”并返回列表页。

## 7. 通用-消息通知模块
### 7.1 获取消息列表（小程序端）
| 项         | 内容                                          |
|------------|-----------------------------------------------|
| 接口路径   | `/message/list`                               |
| 请求方式   | GET                                           |
| 适用端侧   | 小程序端                                     |

#### 返回数据
```json
{
  "data": {
    "list": [
      {
        "id": 1,
        "title": "隐患审核结果",
        "content": "你上报的食堂隐患已处理完成",
        "isRead": 0, // 0=未读，1=已读
        "createTime": "2026-01-13 11:00:00"
      }
    ]
  }
}
```

#### 前端调用注意（标注）
1. 未读消息需加小红点样式（`isRead===0`时显示）；
2. 点击消息后需调用`/message/read`接口标记为已读；
3. 小程序端需监听消息推送（可通过WebSocket或小程序模板消息）。

---

## 从头配置前端-接口对接核心步骤（标注：适配你的从零配置场景）
### 步骤1：封装请求工具（基础）
1. Web端：在`src/web/utils/request.ts`封装Axios，配置基础URL、请求/响应拦截器（处理Token、统一错误提示）；
2. 小程序端：在`src/miniprogram/utils/request.js`封装uni.request，逻辑与Web端一致（替换localStorage为uni.setStorageSync）。

### 步骤2：按模块拆分接口（规范）
```
src/
├── web/api/
│   ├── auth.ts（认证）
│   ├── device.ts（设备管理）
│   ├── alarm.ts（报警管理）
├── miniprogram/api/
│   ├── auth.js（学生登录）
│   ├── report.js（隐患上报）
│   ├── message.js（消息通知）
```

### 步骤3：对接实时推送（Web端）
在Web端入口文件（main.ts）或首页组件中初始化WebSocket，监听报警推送，封装断线重连逻辑。

### 步骤4：测试接口连通性
1. 先启动后端服务，确保`http://localhost:8080/api/auth/login`可访问；
2. 前端调用登录接口，验证Token是否正常返回；
3. 用Postman/APIPost先测试接口，再接入前端代码（降低联调成本）。

---

### 总结
1. 所有接口均适配你的前端技术栈，**标注部分是前端开发的核心注意点**（如小程序必须用uni.uploadFile上传图片）；
2. 通用返回格式需在前端统一解析，401状态码需全局处理（跳转登录）；
3. 从头配置前端时，优先封装请求工具→拆分接口模块→测试基础接口→对接复杂功能（如WebSocket、文件上传）。

如果需要针对某个具体接口（如报警WebSocket、小程序图片上传）提供完整的前端调用代码，或补充接口的异常场景处理，可随时说明。
